---
title: Подготовка к подготовке пользователей с помощью синхронизации службы каталогов в Office 365
ms.author: robmazz
author: robmazz
manager: laurawi
ms.date: 8/21/2018
ms.audience: Admin
ms.topic: article
f1_keywords:
- O365p_AddUsersWithDirSync
- O365M_AddUsersWithDirSync
- O365E_HRCSetupAADConnectAboutLM617031
- O365E_AddUsersWithDirSync
ms.service: o365-administration
localization_priority: Normal
ms.custom: Adm_O365
ms.collection:
- Ent_O365
- M365-identity-device-management
search.appverid:
- MET150
- MOP150
- MOE150
- MBS150
ms.assetid: 01920974-9e6f-4331-a370-13aea4e82b3e
description: В этой статье описано, как подготовить пользователей к работе с Office 365, используя синхронизацию службы каталогов и долгосрочные преимущества использования этого метода.
ms.openlocfilehash: af402950b3681285898d0d87b897d363a693bf98
ms.sourcegitcommit: 1b6ba4043497c27b3a89689766b975f2405e0ec8
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/19/2019
ms.locfileid: "30085108"
---
# <a name="prepare-to-provision-users-through-directory-synchronization-to-office-365"></a>Подготовка к подготовке пользователей с помощью синхронизации службы каталогов в Office 365

Подготовка пользователей с синхронизацией службы каталогов требует больше планирования и подготовки, чем простое управление рабочей или учебной учетной записью непосредственно в Office 365. Для проверки правильности синхронизации локальной службы Active Directory с Azure Active Directory необходимо выполнить дополнительные задачи планирования и подготовки. К вашей организации добавлены следующие преимущества:
  
- Уменьшение количества программ администрирования в организации
- НеОбязательное включение сценария единого входа
- Автоматическое изменение учетной записи в Office 365
    
Более подробную информацию о преимуществах синхронизации службы каталогов можно узнать в статье [схема синхронизации службы каталогов]( https://go.microsoft.com/fwlink/p/?LinkId=525398) и [сведения об удостоверении Office 365 и Azure Active Directory](about-office-365-identity.md).
  
Чтобы определить, какой сценарий лучше всего подходит для вашей организации, изучите [Сравнение средств интеграции каталогов](https://go.microsoft.com/fwlink/p/?LinkId=525320).
  
## <a name="directory-cleanup-tasks"></a>Задачи очистки каталога

Перед началом синхронизации каталога необходимо очистить каталог.
  
Просмотрите также [атрибуты, синхронизированные с Azure Active Directory по Azure AD Connect](https://docs.microsoft.com/azure/active-directory/hybrid/reference-connect-sync-attributes-synchronized).
  
> [!IMPORTANT]
> Если вы не выполняете очистку каталога перед синхронизацией, в процессе развертывания может быть значительно отрицательное значение. Может потребоваться несколько дней или даже недель, чтобы пройти цикл синхронизации службы каталогов, выявить ошибки и повторную синхронизацию. 
  
В локальном каталоге выполните следующие задачи очистки:
  
1. Убедитесь, что у каждого пользователя, который будет использовать службы Office 365, есть действительный и уникальный адрес электронной почты в атрибуте **proxyAddresses**. 
    
2. Удалите все повторяющиеся значения в атрибуте **proxyAddresses**. 
    
3.  Если это возможно, убедитесь, что каждый пользователь, которому будут назначены службы Office 365, имеет допустимое и уникальное значение атрибута **userPrincipalName** в объекте **пользователя** пользователя. Для достижения наилучших результатов синхронизации убедитесь, что локальное имя участника-пользователя Active Directory соответствует имени участника-пользователя в облаке. Если у пользователя нет значения атрибута **userPrincipalName** , то объект **пользователя** должен содержать допустимое и уникальное значение для атрибута **SamAccountName** . Удалите все повторяющиеся значения в атрибуте **userPrincipalName** . 
    
4. Для оптимального применения глобального списка адресов (GAL) проверьте правильность информации в следующих атрибутах:
    
  - givenName 
  - surname
  - displayName
  - Должность
  - Отдел
  - Кабинет
  - Рабочий телефон
  - Мобильный телефон
  - Номер факса
  - Улица, дом
  - Город
  - Область или район
  - Почтовый индекс
  - Страна или регион
    
## <a name="directory-object-and-attribute-preparation"></a>Подготовка объектов и атрибутов каталога

Для успешной синхронизации каталогов между локальным каталогом и Office 365 необходимо, чтобы атрибуты локального каталога были правильно подготовлены. Например, необходимо убедиться, что определенные символы не используются в определенных атрибутах, которые синхронизируются с средой Office 365. НеПредусмотренные символы не приводят к сбою синхронизации службы каталогов, но могут возвращать предупреждение. НеДопустимые символы приведут к сбою синхронизации службы каталогов.
  
Синхронизация службы каталогов также завершится с ошибками, если некоторые пользователи Active Directory имеют один или несколько повторяющихся атрибутов. Каждый пользователь должен иметь уникальные атрибуты.
  
Ниже перечислены атрибуты, которые необходимо подготовить.
  
 **Примечание:** Кроме того, вы можете использовать [средство IdFix](install-and-run-idfix.md) , чтобы сделать этот процесс намного проще. 
  
- **displayName**
    
  - Если в объекте пользователя существует атрибут, он будет синхронизирован с Office 365.
  - Если этот атрибут существует в объекте пользователя, для него должно быть предусмотрено значение. То есть атрибут не должен быть пустым.
  - Максимальное число символов: 256
    
- **givenName **
    
  - Если атрибут существует в объекте пользователя, он будет синхронизирован с Office 365, но он не требуется и не используется в Office 365.
  - Максимальное число символов: 64
    
- **mail**
    
  - Значение атрибута должно быть уникальным в пределах каталога.
    
    > [!NOTE]
    > Если имеются повторяющиеся значения, первый пользователь со значением синхронизируется. Последующие пользователи не будут отображаться в Office 365. Необходимо изменить значение в Office 365 или изменить оба значения в локальном каталоге, чтобы оба пользователя отображались в Office 365. 
  
- **mailNickname** (псевдоним Exchange) 
    
  - Значение атрибута не может начинаться с точки (.).
  - Значение атрибута должно быть уникальным в пределах каталога.
    
- **proxyAddresses **
    
  - Атрибут с несколькими значениями
  - Максимальное количество символов для одного значения: 256
  - Значение атрибута не должно содержать пробел.
  - Значение атрибута должно быть уникальным в пределах каталога.
  - НеДопустимые \< \> символы: (); , [ ] "
    
    Обратите внимание, что недопустимые символы применяются к символам, которые следует за разделителем типов и ":", так как SMTP:User@contso.com разрешен, а SMTP:user:M@contoso.com — нет.
    
    > [!IMPORTANT]
    > Все SMTP-адреса должны соответствовать стандартам обмена сообщениями электронной почты. Если имеются повторяющиеся или нежелательные адреса, ознакомьтесь с разделом справки [Удаление повторяющихся и нежелательных прокси-адресов в Exchange](https://go.microsoft.com/fwlink/?LinkId=293860). 
  
- **sAMAccountName**
    
  - Максимальное количество символов: 20
  - Значение атрибута должно быть уникальным в пределах каталога.
  - НеДопустимые символы: [\ "|, \< \> /: + =;? \* ]
  - Если пользователь имеет недопустимый атрибут **sAMAccountName**, но имеет допустимый атрибут **userPrincipalName**, учетная запись пользователя создается в Office 365. 
  - Если и **SamAccountName** , и **userPrincipalName** являются недопустимыми, необходимо обновить атрибут, расположенный в локальной службе Active Directory **userPrincipalName** . 
    
- **sn** (фамилия) 
    
  - Если атрибут существует в объекте пользователя, он будет синхронизирован с Office 365, но он не требуется и не используется в Office 365.
    
- **targetAddress**
    
    Необходимо, чтобы атрибут **targetAddress** (например, SMTP:Tom@contoso.com), заполненный для пользователя, отображался в глобальном списке адресов Office 365. В сценариях миграции сторонней системы обмена сообщениями для локального каталога потребуется расширение схемы Office 365. Расширение схемы Office 365 также будет добавлять другие атрибуты для управления объектами Office 365, заполненными с помощью средства синхронизации каталогов из локального каталога. Например, вы добавите атрибут **msExchHideFromAddressLists** для управления скрытыми почтовыми ящиками или группами рассылки. 
   
  - Максимальное число символов: 256
  - Значение атрибута не должно содержать пробел.
  - Значение атрибута должно быть уникальным в пределах каталога.
  - НеДопустимые символы \< \> : \ (); , [ ] "
  - Все SMTP-адреса должны соответствовать стандартам обмена сообщениями электронной почты.
    
- **userPrincipalName**
    
  - Атрибут **userPrincipalName** должен быть в формате для входа в Интернет, где за именем пользователя следуют знак "@" и доменное имя: например, user@contoso.com. Все SMTP-адреса должны соответствовать стандартам обмена сообщениями электронной почты.
  - Максимальное количество символов для атрибута **userPrincipalName**: 113. Перед знаком (@) и после него допускается определенное количество символов, а именно: 
  - Максимальное количество символов для имени пользователя, которое находится перед знаком (@): 64
  - Максимальное количество символов для имени домена, которое находится после знака (@): 48
  - НеДопустимые символы: &amp; \* \% +/=? { } | \< \> ( ) ; : , [ ] "
  - Умлаут также является недопустимым символом.
  - В каждом значении **userPrincipalName** необходимо указать символ @. 
  - Символ "@" не может быть первым символом в каждом значении **userPrincipalName**. 
  - Имя пользователя не может заканчиваться точкой (.), амперсандом (&amp;), пробелом или знаком "@".
  - Имя пользователя не может содержать пробелы.
  - Необходимо использовать маршрутизируемые домены; Например, нельзя использовать локальные или внутренние домены.
  - Символы кодировки Юникод преобразуются в символы подчеркивания.
  - **userPrincipalName** не может содержать дублирующиеся значения в каталоге. 
    
## <a name="prepare-the-userprincipalname-attribute"></a>Подготовка атрибута userPrincipalName

Служба Active Directory позволяет конечным пользователям в Организации входить в каталог с помощью **SamAccountName** или **userPrincipalName**. Аналогичным образом пользователи могут войти в Office 365 с помощью имени участника-пользователя (UPN) своей рабочей или учебной учетной записи. Синхронизация службы каталогов пытается создать новых пользователей в Azure Active Directory с использованием того же имени участника-пользователя, что и в локальном каталоге. ИМЯ участника-пользователя отформатировано как адрес электронной почты. 

В Office 365 UPN является атрибутом по умолчанию, который используется для создания адреса электронной почты. Вы можете легко получить **userPrincipalName** (в локальной среде и в Azure Active Directory), а основной адрес электронной почты в **proxyAddresses** задан с разными значениями. Если заданы разные значения, могут быть неудобства для администраторов и конечных пользователей. 
  
Лучше всего выравнивать эти атрибуты, чтобы избежать путаницы. Чтобы удовлетворить требования единого входа с помощью служб федерации Active Directory (AD FS) 2,0, необходимо убедиться, что имена участников-пользователей в Azure Active Directory и в локальной службе Active Directory совпадают и используют допустимое пространство имен доменов.
  
## <a name="add-an-alternative-upn-suffix-to-ad-ds"></a>Добавление альтернативного суффикса имени участника-пользователя в доменные службы Active Directory

Может потребоваться добавить альтернативный суффикс имени участника-пользователя для связи учетных данных организации пользователя с средой Office 365. Суффикс UPN — это часть имени участника-пользователя справа от знака @. Имена участников, используемые для единого входа, могут содержать буквы, цифры, точки, тире и символы подчеркивания, но не другие типы символов.
  
Дополнительные сведения о том, как добавить альтернативный суффикс UPN в Active Directory, можно найти в статье [Подготовка к синхронизации службы каталогов]( https://go.microsoft.com/fwlink/p/?LinkId=525430).
  
## <a name="match-the-on-premises-upn-with-the-office-365-upn"></a>Сравнение локального имени участника-пользователя с именем участника-пользователя Office 365

Если вы уже настроили синхронизацию службы каталогов, имя участника-пользователя для Office 365 может отличаться от локального имени участника-пользователя, определенного в локальной службе каталогов. Это может произойти, если пользователю была назначена лицензия, прежде чем домен был проверен. Чтобы устранить эту проблему, используйте [PowerShell для исправления повторяющегося имени участника](https://go.microsoft.com/fwlink/p/?LinkId=396730) -пользователя и обновления имени участника-пользователя Office 365, чтобы убедиться, что имя участника-пользователя Office совпадает с корпоративным именем пользователя и доменом. Если вы обновляете имя участника-пользователя в локальной службе каталогов и хотите, чтобы он выполнял синхронизацию с удостоверением Azure Active Directory, необходимо удалить лицензию пользователя в Office 365 перед внесением изменений в локальную систему. 
  
Сведения [о подготовке домена без поддержки маршрутизации (например, локального домена) для синхронизации службы каталогов](prepare-a-non-routable-domain-for-directory-synchronization.md).
  
## <a name="directory-integration-tools"></a>Средства интеграции каталогов

Синхронизация службы каталогов — это синхронизация объектов каталогов (пользователей, групп и контактов) из локальной среды Active Directory в инфраструктуру каталогов Office 365, Azure Active Directory. Список доступных инструментов и их функциональных возможностей можно найти в разделе [средства интеграции каталогов](https://go.microsoft.com/fwlink/p/?LinkID=510956) . Рекомендуемое средство — [Microsoft Azure Active Directory Connect](https://go.microsoft.com/fwlink/p/?LinkID=510956). Для получения дополнительных сведений об Azure Active Directory Connect, ознакомьтесь со статьей [интеграция локальных удостоверений с Azure Active Directory](https://go.microsoft.com/fwlink/p/?LinkId=527969).
  
Когда учетные записи пользователей в первый раз синхронизируются с каталогом Office 365, они помечаются как неактивированные. Они не могут отправлять и получать сообщения электронной почты и не потребляют лицензии на подписку. Когда вы будете готовы назначить подписки на Office 365 определенным пользователям, необходимо выбрать и активировать их, наЗначая [пользователям лицензии на office 365 для бизнеса](https://support.office.com/article/997596b5-4173-4627-b915-36abac6786dc).
  
Вы также можете назначить лицензии с помощью [PowerShell](https://go.microsoft.com/fwlink/p/?LinkId=613097) . Узнайте, [как использовать PowerShell для автоматического назначения лицензий пользователям Office 365](https://go.microsoft.com/fwlink/p?LinkID=329805) для автоматизированного решения.