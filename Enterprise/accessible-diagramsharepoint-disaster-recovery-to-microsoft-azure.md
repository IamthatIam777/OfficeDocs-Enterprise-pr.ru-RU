---
title: Доступная схема — аварийное восстановление SharePoint в Microsoft Azure
ms.author: josephd
author: JoeDavies-MSFT
manager: laurawi
ms.date: 12/15/2017
audience: ITPro
ms.topic: article
ms.collection: Ent_O365
ms.service: o365-solutions
localization_priority: Normal
ms.assetid: 4b855224-8e67-4efa-a3a4-908ee0ca6412
f1.keywords:
- NOCSH
description: Данная статья представляет собой текстовую версию схемы "Аварийное восстановление SharePoint в Microsoft Azure".
ms.openlocfilehash: f9bbc62994c1ca36425fa35a4ce294e22596d793
ms.sourcegitcommit: 99411927abdb40c2e82d2279489ba60545989bb1
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 02/07/2020
ms.locfileid: "41843850"
---
# <a name="accessible-diagram---sharepoint-disaster-recovery-to-microsoft-azure"></a>Доступная схема — аварийное восстановление SharePoint в Microsoft Azure

**Сводка:** Эта статья представляет собой текстовую версию схемы с именем "аварийное восстановление SharePoint" в Microsoft Azure.
  
На этом плакате приведены примеры архитектур, используемых для создания среды восстановления в Azure. 
  
## <a name="on-premises-environment-with-an-azure-recovery-environment"></a>Локальная среда со средой восстановления Azure

На схеме показан пример архитектуры, используемой для рабочей среды, размещенной в локальной среде, в которой, в свою очередь, применяется Azure для восстановления. 
  
### <a name="on-premises-production-environment"></a>Локальная рабочая среда

На сопроводительной схеме показана динамическая рабочая среда с фермой серверов, разбитой на четыре уровня. 
  
#### <a name="tier-1"></a>Уровень 1

На этом уровне расположены два сервера для служб переднего плана и обработки запросов. Кроме того, здесь есть раздел индекса, в котором имеются реплики обоих серверов.  
  
#### <a name="tier-2"></a>Уровень 2

На этом уровне расположены два сервера для распределенного кэша. 
  
#### <a name="tier-3"></a>Уровень 3

На этом уровне расположены три сервера. Каждый сервер предоставляет указанные ниже службы.  
  
- Внутренние службы 
    
- Администратор 
    
- Диспетчер бизнес-правил 
    
- Обход контента 
    
- Обработка контента 
    
- Аналитика 
    
#### <a name="tier-4"></a>Уровень 4

На этом уровне расположены два сервера. У каждого сервера имеется три указанные ниже группы доступности.  
  
- Группа доступности 1 обеспечивает возможности поиска. 
    
- Группа доступности 2 предоставляет контент, сведения о конфигурации и приложения-службы. 
    
- Группа доступности 3 предоставляет контент. 
    
Кроме того, на этом уровне имеется сервер для общего доступа к файлам. Для обмена данными с этим сервером серверы уровня 4 используют функцию доставки журналов. Этот сервер посредством репликации распределенной файловой системы обменивается данными с сервером для общего доступа к файлам в среде восстановления Azure с "горячим" резервированием, как описано в разделе ниже.  
  
### <a name="azure-recovery-environment"></a>Среда восстановления Azure

#### <a name="warm-standby-environment-running-virtual-machines"></a>Среда с "горячим" резервированием, в которой работают виртуальные машины

На сопроводительной схеме показана локальная среда, точно реплицированная в среде восстановления Azure. В этой среде сервер для общего доступа к файлам связан с локальной средой посредством репликации распределенной файловой системы. Репликация распределенной файловой системы передает журналы из рабочей среды в среду восстановления через сервер для общего доступа к файлам.  
  
### <a name="overview"></a>Обзор

Среда аварийного восстановления для локальной фермы SharePoint 2013 может быть размещена в Azure. 
  
-  Службы инфраструктуры Azure обеспечивают дополнительный центр данных.
    
- Вы платите только за используемые ресурсы. 
    
- Чтобы соблюсти требования к масштабу и емкости, после аварии можно развернуть небольшие фермы восстановления. 
    
Ферма восстановления в Azure настраивается (насколько это возможно) так же, как и рабочая локальная ферма. 
  
- Одинаковое представление ролей серверов. 
    
- Одинаковая конфигурация настроек. 
    
- Одинаковая конфигурация компонентов поиска (они могут размещаться на рабочей ферме меньшей версии). 
    
Доставка журналов и репликация распределенной файловой системы используются для копирования резервных копий баз данных и журналов транзакций в ферму Azure. 
  
- Репликация распределенной файловой системы используется для передачи журналов из рабочей среды в среду восстановления. В глобальной сети сценарий с использованием репликации распределенной файловой системы более эффективен, чем доставка журналов непосредственно на дополнительный сервер в Azure. 
    
- Журналы воспроизводятся на компьютерах под управлением SQL Server на основе Azure. 
    
- Базы данных, доставленные с журналами, не прикрепляются к ферме, пока не будет выполнено восстановление. 
    
Процедуры отработки отказа. 
  
1. Остановите доставку журналов. 
    
2. Остановите прием трафика основной фермы. 
    
3. Воспроизведите журналы транзакций. 
    
4. Присоедините базу данных контента к ферме. 
    
5. Запустите полный обход. 
    
6. Восстановите приложения-службы из служб реплицированных баз данных. 
    
Ниже перечислены цели восстановления для этого решения. 
  
- Сайты и контент 
    
- Поиск (повторный обход контента, без журнала поиска) 
    
- Службы
    
С помощью консультационных служб или партнеров корпорации Майкрософт можно решить указанные ниже дополнительные вопросы. 
  
- Синхронизация решений пользовательской фермы 
    
- Подключения к локальным источникам данных (подключение к бизнес-данным и источники поиска контента) 
    
- Сценарии восстановления поиска 
    
- Целевое время восстановления (RTO) и целевая точка восстановления (RPO) 
    
#### <a name="cold-standby-environment-running-virtual-machines"></a>Среда с холодным резервированием, в которой работают виртуальные машины

Среды с холодным резервированием запускаются дольше, но они дешевле. 
  
- Ферма создается в полном масштабе, но после создания фермы виртуальные машины будут остановлены. Вы оплачиваете только затраты на обработку, когда виртуальные машины работают. Кроме того, может взиматься плата за использование хранилища и передачу данных по сети.  
    
- При аварии все виртуальные машины фермы запускаются и получают исправления. 
    
- К базам данных фермы применяются резервные копии и журналы транзакций. 
    
Ниже перечислены дополнительные процедуры, которые необходимо выполнять в средах с холодным резервированием. 
  
- Регулярно включайте виртуальные машины для получения исправлений и обновлений, а также для проверки среды. 
    
- Выполняйте процедуры обновления DNS и IP-адресов. 
    
- Настройте SQL AlwaysOn после отработки отказа. 
    
На сопроводительной схеме показана реплицированная среда восстановления на базе виртуальных машин. После отработки отказа путем перехода в среду с холодным резервированием будут запущены все виртуальные машины, а группы доступности будут настроены с помощью журналов воспроизведения. Это сделает серверы баз данных доступными.  
  
## <a name="sharepoint-recovery-environment-in-azure"></a>Среда восстановления SharePoint в Azure

Проектирование и создание среды отработки отказов в Azure. 
  
- Создайте виртуальную сеть в Azure. 
    
- Подключите локальную сеть к виртуальной сети в Azure с помощью VPN-подключения типа "сеть-сеть". Это подключение использует динамический шлюз в Azure.  
    
- Разверните один или несколько контроллеров доменов в виртуальной сети Azure и настройте их для работы с вашим локальным доменом. Эти контроллеры доменов представляют собой серверы каталогов.  
    
- Настройте ферму SharePoint для облачных служб и групп доступности. 
    
- Разверните ферму SharePoint и файловый сервер, чтобы разместить на них файловые ресурсы. 
    
- Настройте доставку журналов и репликацию распределенной файловой системы между локальной средой и средой восстановления на основе Azure. 
    
На сопроводительной схеме показаны локальная среда и виртуальная сеть Azure с указанными ниже компонентами. 
  
### <a name="on-premises-environment"></a>Локальная среда

- Windows Server 2012 RRAS 
    
- Сервер Active Directory 
    
Локальные сетевые интерфейсы с виртуальной сетью Azure на базе VPN-шлюза. 
  
### <a name="azure-virtual-network"></a>Виртуальная сеть Azure

Интерфейсы VPN-шлюза с активной подсетью VPN-шлюза. 
  
В виртуальной сети Azure имеются три указанные ниже облачные службы. 
  
- В первой облачной службе имеются два сервера Active Directory и DNS с группой доступности.  
    
- Вторая облачная служба содержит три набора серверов: два сервера распределенного кэша с набором доступности. Два сервера переднего плана с набором доступности. Три внутренних сервера с набором доступности.
    
- В третьей облачной службе имеются три сервера баз данных с группой доступности. Один из этих серверов баз данных представляет собой файловый ресурс для доставки журналов и третий узел большинства узлов для SQL Server AlwaysOn.  
    
### <a name="build-the-ad-ds-hybrid-environment"></a>Создание гибридной среды доменных служб Active Directory

Конфигурация доменных служб Active Directory для этого решения представляет собой сценарий гибридного развертывания, в котором эти службы развертываются частично на локальных виртуальных машинах и частично — на виртуальных машинах Azure.  
  
Важно! перед развертыванием доменных служб Active Directory в Azure ознакомьтесь с рекомендациями по развертыванию Windows Server Active Directory наhttps://docs.microsoft.com/windows-server/identity/ad-ds/introduction-to-active-directory-domain-services-ad-ds-virtualization-level-100)виртуальных машинах Microsoft Azure (. 
  
 
Данная эталонная архитектура включает две виртуальные машины, настроенные в качестве контроллеров доменов. Каждая виртуальная машина настраивается указанным ниже образом. 
  
- Размер: малый. 
    
- Операционная система: Windows Server 2012. 
    
- Роль: контроллер домена доменных служб Active Directory, назначенный в качестве сервера глобального каталога. В этой конфигурация уменьшается выходной трафик, проходящий через VPN-подключение. В среде с несколькими доменами и высокой скоростью изменения необходимо настроить локальные контроллеры доменов так, чтобы они не синхронизировались с серверами глобального каталога в Azure.   
    
- Диски данных — разместите базы данных AD DS, журналы и SYSVOL на дисках с данными Azure. Не размещайте их на диске операционной системы и временных дисках, предоставленных Azure. Это важно. 
    
- Role — установите и настройте Windows DNS на контроллерах домена. 
    
- IP-адреса — используйте динамические IP-адреса. Для этого необходимо создать виртуальную сеть Azure. 
    

