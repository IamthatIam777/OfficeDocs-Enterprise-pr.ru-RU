---
title: Настройка поиска для OneDrive для бизнеса Multi географически
ms.author: tlarsen
author: tklarsen
manager: arnek
ms.date: 4/3/2018
ms.audience: ITPro
ms.topic: article
ms.service: o365-solutions
localization_priority: Normal
description: Сведения о настройке поиска в среде с несколькими географически.
ms.openlocfilehash: 5aa1e9eb189e00dbed8f575e88046b661341bf52
ms.sourcegitcommit: 21cc62118b78b76d16ef12e2c3eff2c0c789e3d0
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 04/05/2018
---
# <a name="configure-search-for-onedrive-for-business-multi-geo"></a>Настройка поиска для OneDrive для бизнеса Multi географически

В среде с несколькими географически SharePoint Online (SPO) может иметь одну клиента Office 365 организации, но хранить их содержимого SharePoint в нескольких географических местах - одного центрального местоположения и один или несколько вспомогательные географического расположения.

Каждый свое географическое местоположение имеет свой собственный центр поиска и индекс поиска. При выполнении пользователем поиска, запрос fanned в работе для всех индексов и объединяются возвращаемых результатов.

К примеру пользователей в одном месте географически можно найти контент, который хранится в другом месте географически, и для контента на сайте SharePoint, в которую различных географического расположения. Если у пользователя есть доступ к этому содержимому, поиска будет показывать результат.

## <a name="which-search-clients-work-in-a-multi-geo-environment"></a>В среде с несколькими географически которого поиск работы клиентов?

Эти клиенты могут возвращать результаты из всех расположений географически:

-   OneDrive для бизнеса

-   Delve

-   Домашняя страница SharePoint

-   Центр поиска

-   Настраиваемые приложения поиска, использующие API поиска SharePoint

### <a name="onedrive-for-business"></a>OneDrive для бизнеса

Настройка среды ферма с несколькими географически сразу же пользователей, в которых поиск в OneDrive получать результаты из всех расположений географически.

### <a name="delve"></a>Delve

Настройка среды ферма с несколькими географически сразу же пользователей, в которых поиск в Delve получать результаты из всех расположений географически.

Веб-канал Delve и Карточка профиля отображаются только предварительный просмотр файлов, которые хранятся в **центральном** расположении. Для файлов, которые хранятся в вспомогательных географического расположения вместо этого отображается значок для типа файла.

### <a name="the-sharepoint-home-page"></a>Домашняя страница SharePoint

Как настроить среду несколькими географически пользователи увидят новости, последние и число сайтов из нескольких расположений географически на своей домашней странице SharePoint. При использовании поля поиска на домашней странице SharePoint, они получите объединенных результатов из нескольких расположений географически.

### <a name="the-search-center"></a>Центр поиска

После Multi-географически среды был настроен, каждого центра поиска по-прежнему производится только Показать результаты из географического расположения. Администраторы должны [Изменить параметры каждого центра поиска](#_Set_up_a_1) для получения результатов из всех расположений географически. После этого пользователи, в которых поиск в центре поиска получать результаты из всех расположений географически.

### <a name="custom-search-applications"></a>Настраиваемые приложения поиска

Как обычно настраиваемые приложения поиска взаимодействовать с индексы поиска с помощью существующих API REST поиска SharePoint. Для получения результатов из всех или некоторых географического расположения, приложение должно [вызов API и включения новых параметров запроса несколькими географически](#_Get_custom_search) в запросе. Это запускает вентилятора из него запросов на все географического расположения.

## <a name="whats-different-about-search-in-a-multi-geo-environment"></a>Каковы отличия, о поиске в среде с несколькими географически?

Некоторые функции поиска, которые могут быть знакомы, работают по-разному в среде с несколькими географически.

<table>
<thead>
<tr class="header">
<th align="left"><strong>Компонент</strong></th>
<th align="left"><strong>Как это работает</strong></th>
<th align="left"><strong>Обходной путь</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Результатов повышенного уровня</td>
<td align="left">Можно создать правила запросов с повышенным уровнем результаты на различных уровнях: для всей клиента, для семейства веб-сайтов или для сайта. В среде с несколькими географически определите результатов повышенного уровня на уровне <strong>клиента</strong> , чтобы повысить уровень результатов в центрах поиска во <strong>всех</strong> расположениях географически. Вы <strong>только</strong> продвигать результаты в центре поиска, который находится в папке географически семейства веб-сайтов или сайта, определите результаты на уровне <strong>семейства веб-сайтов</strong> или <strong>сайта</strong> .</td>
<td align="left">Если не требуется различных результатов повышенного уровня одного географического расположения, например различные правила поездок, мы рекомендуем определение результатов на уровне клиента повышенного уровня.</td>
</tr>
<tr class="even">
<td align="left">Уточнения поиска</td>
<td align="left">Поиск возвращает уточнений из всех расположений географически клиента и затем объединяет их. Объединение — это все возможное, что означает, что счетчиков может быть точных 100%. Для большинства сценариев на основе механизмов поиска это является достаточно.</td>
<td align="left">Для приложения на основе поиска, зависящих от полнота уточнения запросов для каждого географического расположения независимо друг от друга без использования несколькими географически развертывания.</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">Ферма с несколькими географически поиска не поддерживает динамические сегментация для числовых уточнений.</td>
<td align="left">Используйте <a href="https://docs.microsoft.com/en-us/sharepoint/dev/general-development/query-refinement-in-sharepoint">параметр «Discretize»</a> для числовых уточнений.</td>
</tr>
<tr class="even">
<td align="left">Идентификаторы документов</td>
<td align="left">При разработке приложения на основе механизмов поиска, которое зависит от идентификаторами документов, обратите внимание на то, что идентификаторы документов в среде с несколькими географически не уникальный в географически подразделениях, они являются уникальными для географического расположения.</td>
<td align="left">Мы добавили столбец, который идентифицирует географического расположения. Используйте этот столбец для обеспечения уникальности. Этот столбец является с именем «GeoLocationSource».</td>
</tr>
<tr class="odd">
<td align="left">Число результатов</td>
<td align="left">Страницы результатов поиска отображает объединенный результаты из географического расположения, но невозможно страницы за пределы 500 результатов.</td>
<td align="left"></td>
</tr>
</tbody>
</table>

## <a name="whats-not-supported-for-search-in-a-multi-geo-environment"></a>Что не поддерживается для поиска в среде с несколькими географически?

Некоторые функции поиска, которые могут быть знакомы, не поддерживаются в среде с несколькими географически.

<table>
<thead>
<tr class="header">
<th align="left"><strong>Функция поиска</strong></th>
<th align="left"><strong>Примечание</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Проверка подлинности только для приложений</td>
<td align="left">Только проверка подлинности (привилегированный доступ из служб) не поддерживается в географически несколькими поиска.</td>
</tr>
<tr class="even">
<td align="left">Гости</td>
<td align="left">Гости получить только результаты из географического расположения, они поиска из.</td>
</tr>
</tbody>
</table>

## <a name="how-does-search-work-in-a-multi-geo-environment"></a>Как работает поиска работает в среде с несколькими географически?

**Все** клиенты поиска использовать существующие интерфейсы API REST поиска SharePoint для взаимодействия с индексы поиска.
<img src="media/configure-search-for-multi-geo_image1-1.png" />

1. Клиент поиска вызывает конечная точка REST поиска с помощью свойства запроса EnableMultiGeoSearch = true.
2. Запрос отправляется все географического расположения в клиентов.
3. Результаты поиска из каждого географического расположения объединенных и ранжирования.
4. Клиент получает результаты стандартизированное.



<span id="_Set_up_a" class="anchor"><span id="_Ref501388384" class="anchor"></span></span>Обратите внимание на то, что мы не объединение результатов поиска, пока мы получили результаты из всех расположений географически. Это означает, что поиск несколькими географически дополнительные задержки, по сравнению с поисков в среде с только один географического расположения.

<span id="_Set_up_a_1" class="anchor"><span id="_Ref505252370" class="anchor"></span></span>
## <a name="get-a-search-center-to-show-results-from-all-geo-locations"></a>Получение центра поиска, чтобы показать результаты из всех расположений географически

Каждого центра поиска имеет несколько вертикали и должны настроить по вертикали каждого по отдельности.

1.  Убедитесь, что выполняются эти действия с использованием учетной записи, которая имеет разрешение на изменение страницы результатов поиска и веб-части результатов поиска.

2.  Перейдите на страницу результатов поиска (просматривать страницы результатов поиска [списка](https://support.office.com/article/174d36e0-2f85-461a-ad9a-8b3f434a4213) )

3.  Выберите вертикальная для установки, щелкните значок шестеренки **Параметры** в верхнем правом углу окна и выберите команду **Изменить страницу**. Откроется страница результатов поиска в режиме редактирования.

     ![](media/configure-search-for-multi-geo_image2.png)
1.  В веб-части результатов поиска наведите указатель на верхний правый угол веб-части щелкните стрелку и выберите в меню команду **Изменить веб-часть** . Откроется панель инструмента веб-части результатов поиска в разделе ленты в верхней правой части страницы.![](media/configure-search-for-multi-geo_image3.png)

1.  В области инструментов веб-части в разделе **Параметры** в области **результатов задают параметры**выберите **Показать несколькими географически результатов** для получения веб-части результатов поиска для отображения результатов из всех расположений географически.

2.  Нажмите **кнопку ОК** , чтобы сохранить изменения и закрыть панель инструментов веб-части.

3.  Проверка изменений для веб-части результатов поиска, щелкнув **Возврат** на вкладке Страница главного меню.

4.  Публикация изменений с помощью ссылки, содержащиеся в примечание в верхней части страницы.

<span id="_Get_custom_search" class="anchor"><span id="_Ref501388387" class="anchor"></span></span>
## <a name="get-custom-search-applications-to-show-results-from-all-or-some-geo-locations"></a>Получение настраиваемые приложения поиска для отображения результатов из всех или некоторых географического расположения

Настраиваемые приложения поиска получать результаты из всех или некоторых, географического расположения, путем указания параметров запроса с запросом на API REST поиска SharePoint. В зависимости от параметров запроса запрос fanned все географического расположения или некоторые географического расположения. Например если вам требуется только для запроса подмножество географически местоположения, чтобы найти информацию, можно управлять веером только такие. Если запрос пройдет успешно, API REST поиска SharePoint возвращает данные ответа.

### <a name="query-parameters"></a>Параметры запроса

EnableMultiGeoSearch — это логическое значение, указывает ли запрос должен fanned в работе с индексами другие расположения географически несколькими географически клиента. Значение **true,** чтобы проходят запросов; **значение false,** чтобы не проходят запроса. Значение по умолчанию — **false**. Если этот параметр не указан, запрос — это **не** fanned в работе других географического расположения. При использовании параметра в среде, где не несколькими географически параметр игнорируется.

Типа клиента — это строка. Введите имя уникальное клиента для каждого приложения поиска. Если этот параметр не указан, запрос — это **не** fanned в работе других географического расположения.

MultiGeoSearchConfiguration — это необязательный список из которых географически расположений в различных-географически клиентов для проходят запрос к при **EnableMultiGeoSearch** имеет **значение true**. Если не включить этот параметр, или оставьте его пустым, запрос fanned в работе для всех географического расположения. Для каждого географического расположения введите указанные ниже представлен в формате JSON.

<table>
<thead>
<tr class="header">
<th align="left">Элемент</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">DataLocation</td>
<td align="left">Расположение географически, например им.</td>
</tr>
<tr class="even">
<td align="left">Конечная точка</td>
<td align="left">Конечная точка следует подключиться, напримерhttps://contoso.sharepoint.com</td>
</tr>
<tr class="odd">
<td align="left">SourceId</td>
<td align="left">Идентификатор GUID источника результатов, например B81EAB55-3140-4312-B0F4-9459D1B4FFEE.</td>
</tr>
</tbody>
</table>

Если опустить DataLocation или конечную точку или дублируются DataLocation, не удается выполнить запрос. [Вы можете получать сведения о конечной точки клиента географического расположения с помощью Microsoft Graph](https://docs.microsoft.com/en-us/sharepoint/dev/solution-guidance/multigeo-discovery).

### <a name="response-data"></a>Данные ответа

MultiGeoSearchStatus — это свойство, которое возвращает API поиска SharePoint в ответ на запрос. Значение свойства — это строка и дает следующие сведения о результатах, возвращаемых API поиска SharePoint:

<table>
<thead>
<tr class="header">
<th align="left">Значение</th>
<th align="left">Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Полный доступ</td>
<td align="left">Полный результаты из <strong>всех</strong> расположений географически.</td>
</tr>
<tr class="even">
<td align="left">Частично</td>
<td align="left">Частичный результаты из одного или нескольких географического расположения. Результаты не завершены из-за временные ошибки.</td>
</tr>

</tbody>
</table>

### <a name="query-using-the-rest-service"></a>Запрос с использованием службы REST

Запрос GET позволяет определить параметры запроса в URL-адрес. С помощью запроса POST передайте параметров запроса в тексте запроса в формате JavaScript Object Notation (JSON).

#### <a name="request-headers"></a>Заголовки запросов

<table>
<thead>
<tr class="header">
<th align="left">Имя</th>
<th align="left">Значение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Content-Type</td>
<td align="left">приложение/json; odata = verbose</td>
</tr>
</tbody>
</table>

#### <a name="sample-get-request-thats-fanned-out-to-all-geo-locations"></a>Пример запроса GET, fanned в работе, чтобы **все** географического расположения

https:// \<клиента\>/\_api/search/query?querytext = «sharepoint» & свойства = «EnableMultiGeoSearch:true» & типа клиента = "Мои\_клиента\_идентификатор"

#### <a name="sample-get-request-to-fan-out-to-some-geo-locations"></a>Пример запроса GET для проходят **некоторые** географического расположения

https:// <tenant>/_api/search/query?querytext = «узел» & типа клиента = «my_client_id» & Свойства = "EnableMultiGeoSearch:true, MultiGeoSearchConfiguration: [{DataLocation\:«Им»\,конечная точка\:«https\: contosoNAM.sharepoint.com»\,SourceId\:«B81EAB55-3140-4312-B0F4-9459D1B4FFEE»}\,{DataLocation\:«Может»\,конечная точка\:«https\://contosoCAN.sharepoint-df.com»}] "

#### <a name="sample-post-request-thats-fanned-out-to-all-geo-locations"></a>Пример запроса POST, fanned в работе, чтобы **все** географического расположения

    {
        "request": {
            "__metadata": {
            "type": "Microsoft.Office.Server.Search.REST.SearchRequest"
        },
        "Querytext": "sharepoint",
        "Properties": {
            "results": [
                {
                    "Name": "EnableMultiGeoSearch",
                    "Value": {
                        "QueryPropertyValueTypeIndex": 3,
                        "BoolVal": true
                    }
                }
            ]
        },
        "ClientType": "my_client_id"
        }
    }


#### <a name="sample-post-request-thats-fanned-out-to-some-geo-locations"></a>Пример запроса POST, fanned в работе для **некоторых** географического расположения


    {
        "request": {
            "Querytext": "SharePoint",
            "ClientType": "my_client_id",
            "Properties": {
                "results": [
                    {
                        "Name": "EnableMultiGeoSearch",
                        "Value": {
                            "QueryPropertyValueTypeIndex": 3,
                            "BoolVal": true
                        }
                    },
                    {
                        "Name": "MultiGeoSearchConfiguration",
                        "Value": {
                        "StrVal": "[{\"DataLocation\":\"NAM\",\"Endpoint\":\"https://contoso.sharepoint.com\",\"SourceId\":\"B81EAB55-3140-4312-B0F4-9459D1B4FFEE\"},{\"DataLocation\":\"CAN\",\"Endpoint\":\"https://contosoCAN.sharepoint.com\"}]",
                            "QueryPropertyValueTypeIndex": 1
                        }
                    }
                ]
            }
        }
    }

### <a name="query-using-csom"></a>Запрос с использованием CSOM

Ниже приведен пример запроса CSOM, fanned в работе, чтобы **все** географического расположения:

    var keywordQuery = new KeywordQuery(ctx);
    keywordQuery.QueryText = query.SearchQueryText;
    keywordQuery.ClientType = <enter a string here>;
    keywordQuery["EnableMultiGeoSearch"] = true;

