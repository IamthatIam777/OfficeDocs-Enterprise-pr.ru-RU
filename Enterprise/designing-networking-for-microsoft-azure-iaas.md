---
title: Проектирование сети для Microsoft Azure IaaS
ms.author: josephd
author: JoeDavies-MSFT
manager: laurawi
ms.date: 11/28/2018
ms.audience: ITPro
ms.topic: conceptual
ms.service: o365-solutions
localization_priority: Normal
search.appverid:
- MET150
ms.collection: Ent_O365
ms.custom: Ent_Architecture
ms.assetid: 9cb70c9d-9ed9-47cc-af5a-6403d87d3372
description: 'Сводка: Сведения о разработке оптимизированного сети для рабочих нагрузок в Microsoft Azure IaaS.'
ms.openlocfilehash: d13c1d4b985c633b8336dc33253e1350a54b5a39
ms.sourcegitcommit: 25a022f4ef4e56c5407e8e3a8a34265f8fc94264
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 11/29/2018
ms.locfileid: "26872340"
---
# <a name="designing-networking-for-microsoft-azure-iaas"></a>Проектирование сети для Microsoft Azure IaaS

 **Сводка:** Понять, как Разработка оптимизированного сети для рабочих нагрузок в Microsoft Azure IaaS.
  
Оптимизация сетей для выполнения ИТ-задач в Azure IaaS требует понимания виртуальных сетей, пространств адресов, маршрутизации, DNS и балансировки нагрузки Azure.
  
## <a name="planning-steps-for-any-vnet"></a>Этапы планирования для любой виртуальной сети

Ниже перечислены шаги, которыми следует руководствоваться при планировании виртуальной сети любого типа.
  
### <a name="step-1-prepare-your-intranet-for-microsoft-cloud-services"></a>Шаг 1. Подготовьте интрасеть для облачных служб (Майкрософт).

Выполните **действия по подготовке сети для облачных служб (Майкрософт)**, описанные в статье [Общие элементы подключения к облаку Майкрософт](common-elements-of-microsoft-cloud-connectivity.md).
  
### <a name="step-2-optimize-your-internet-bandwidth"></a>Шаг 2. Оптимизируйте пропускную способность канала доступа в Интернет.

Оптимизируйте скорость интернет-соединения, выполнив действия 2–4 из раздела **Действия по подготовке сети для служб Microsoft SaaS** статьи [Проектирование сети для Microsoft SaaS](designing-networking-for-microsoft-saas.md).
  
### <a name="step-3-determine-the-type-of-vnet-cloud-only-or-cross-premises"></a>Шаг 3. Выберите тип виртуальной сети (только облачная или распределенная).

Только облачные сети не подключаются к локальным сетям. Пример:
  
**Рис. 1. Только облачная виртуальная сеть**

![Рис. 1. Виртуальная сеть в Azure, полностью размещенная в облаке](media/8be19104-02b3-4a7f-b0a0-30d6fcf8890b.png)
  
На рисунке 1 показан набор виртуальных машин в только облачной виртуальной сети.
  
В распределенной виртуальной сети имеется подключение VPN типа "сеть-сеть" или ExpressRoute к локальной сети через шлюз Azure. Пример:
  
**Рис. 2. Распределенная виртуальная сеть**

![Рис. 2. Распределенная виртуальная сеть в Azure](media/caacf007-e0dc-45d3-9531-441109776d25.png)
  
На рисунке 2 представлен набор виртуальных машин в распределенной виртуальной сети, которая подключена к локальной сети.
  
Дополнительные сведения см. в разделе [Этапы планирования для распределенной виртуальной сети](designing-networking-for-microsoft-azure-iaas.md#cross_prem) далее в этой статье.
  
### <a name="step-4-determine-the-address-space-of-the-vnet"></a>Шаг 4. Определите адресное пространство для виртуальной сети.

В таблице 1 показаны адресные пространства для различных типов виртуальных сетей.
  
|**Тип виртуальной сети**|**Адресное пространство виртуальной сети**|
|:-----|:-----|
|Только облачная  <br/> |Произвольное частное адресное пространство  <br/> |
|Только облачная с межсоединениями  <br/> |Произвольный private, но не совпадает с другими подключенных VNets  <br/> |
|Распределенная  <br/> |Частное адресное пространство, не перекрывающееся с локальными сетями  <br/> |
|Распределенная с межсоединениями  <br/> |Частное адресное пространство, не перекрывающееся с другими локальными сетями и другими подключенными виртуальными сетями  <br/> |
   
 **Таблица 1. Типы виртуальных сетей и соответствующие адресные пространства**
  
Виртуальным машинам назначаются конфигурации адресов из адресного пространства подсети. За это отвечает сервер DHCP:
  
- Адрес/маска подсети
    
- Шлюз по умолчанию
    
- IP-адреса DNS-серверов
    
Кроме того, можно зарезервировать статический IP-адрес.
  
Виртуальным машинам также можно назначать общедоступные IP-адреса. Это можно сделать как отдельно для каждой машины, так и из облачной службы, содержащей виртуальные машины (только для машин, развернутых классическим способом).
  
### <a name="step-5-determine-the-subnets-within-the-vnet-and-the-address-spaces-assigned-to-each"></a>Шаг 5. Определите подсети в виртуальной сети и назначьте адресное пространство каждой из них.

В виртуальных сетях существует два типа подсетей: подсеть шлюза и подсеть с размещенными виртуальными машинами.
  
**Рис. 3. Два типа подсетей в Azure**

![Рис. 3. Два типа подсетей в Azure](media/2eaa512d-1293-4e9b-b927-6bfe0fc0acb4.png)
  
На рисунке 3 показаны VNet, содержащий шлюза подсети, которая имеет шлюз Azure и набор подсетей размещения виртуальной машины, содержащий виртуальных машин.
  
Подсеть шлюза Azure требуется службе Azure для размещения двух виртуальных машин шлюза Azure. Длина префикса для указываемого адресного пространства должна составлять хотя бы 29 бита (например: 192.168.15.248/29). Рекомендуется использовать префикс длиной 28 бита или менее, особенно, если планируется использовать ExpressRoute.
  
При определении адресное пространство подсети Azure шлюза рекомендуется:
  
1. Выберите размер подсети шлюза.
    
2. В переменных битах в адресном пространстве виртуальной сети задайте для битов, используемых для подсети шлюза, значение 0, а для оставшихся битов — значение 1.
    
3. Преобразуйте полученный результат в десятичный формат и выразите его как адресное пространство, длина префикса которого соответствует размеру подсети шлюза.
    
При использовании этого метода адресное пространство для подсети шлюза всегда будет находиться в самом конце адресного пространства виртуальной сети.
  
Вот пример определения префикса адреса для подсети шлюза: адресное пространство виртуальной сети — 10.119.0.0/16. Организация изначально будет использовать VPN-подключение типа "сеть-сеть", но в итоге перейдет на ExpressRoute. В таблице 2 представлены действия по определению префикса адреса для подсети шлюза в нотации сетевых префиксов и результаты этих действий.

Ниже приведены действия и пример определения префикс адреса подсети шлюза.

1. Определите размер шлюза подсети. Для этого примера следует выбрать /28.
2. Значение двоичных файлов в переменную часть VNet адресного пространства (b) 0 для шлюза бит подсети (G), в противном случае — 1 (V). Для этого примера мы используем 10.119.0.0/16 адресное пространство для VNet.<br/>
<br/>10.119. bbbbbbbb. bbbbbbbb<br/>10.119. VVVVVVVV. VVVVGGGG<br/>10.119. 11111111. 11110000<br/><br/>
3. Преобразуйте результат на шаге 2 в десятичное и express как адресное пространство. Для этого примера 10.119. 11111111. 11110000 — 10.119.255.240, а длина префикса из шага 1, (28 в нашем примере), полученный префикс адреса подсети шлюза — 10.119.255.240/28.
  
Для получения дополнительных сведений в разделе [Калькулятор пространства адресов для подсетей Azure шлюза](https://gallery.technet.microsoft.com/scriptcenter/Address-prefix-calculator-a94b6eed) .
  
Подсети с размещенными виртуальными машинами — это сети, в которых размещаются виртуальные машины Azure, что можно сделать, руководствуясь стандартными инструкциями для локальных сетей, например, используя общую роль, уровень приложений или инструкции по изоляции подсети.
  
Azure использует сначала 3 адреса для каждой подсети. Таким образом число возможных адресов в Azure подсети — 2<sup>n</sup> - 5, где n — число бит узла. В таблице 3 показано ряду виртуальных машин требуется, число, где размещается бит необходимые и соответствующий размер подсети.
  
|**Необходимо виртуальных машин**|**Биты узлов**|**Размер подсети**|
|:-----|:-----|:-----|
|1–3  <br/> |3   <br/> |/29  <br/> |
|4–11  <br/> |4   <br/> |/28  <br/> |
|12–27  <br/> |5   <br/> |/27  <br/> |
|28–59  <br/> |6   <br/> |/26  <br/> |
|60–123  <br/> |7   <br/> |/25  <br/> |
   
 **Таблица 3. Требования к виртуальным машинам и размерам подсети**
  
Дополнительные сведения о максимальный объем виртуальных машин в подсети или VNet можно [Ограничения для сети](https://docs.microsoft.com/azure/azure-subscription-service-limits#networking-limits).
  
Для получения дополнительных сведений см [Планирование и проектирование виртуальные сети Azure](https://azure.microsoft.com/documentation/articles/virtual-network-vnet-plan-design-arm/).
  
### <a name="step-6-determine-the-dns-server-configuration-and-the-addresses-of-the-dns-servers-to-assign-to-vms-in-the-vnet"></a>Шаг 6. Определите конфигурацию DNS-сервера и адреса DNS-серверов для назначения виртуальным машинам в виртуальной сети.

Azure назначает виртуальным машинам адреса DNS-серверов с помощью сервера DHCP. DNS-серверы могут:
  
- предоставляться Azure: регистрация локального имени, а также разрешение локальных и интернет-имен;
    
- указываться вами: регистрация локального или интернет-имени, а также разрешение имен в интрасети или Интернете.
    
В таблице 4 представлены различные конфигурации DNS-сервера для каждого типа виртуальной сети.
    
|**Тип виртуальной сети**|**DNS-сервер**|
|:-----|:-----|
|Только облачная  <br/> |Разрешение локальных и интернет-имен службой Azure  <br/> Виртуальная машина Azure для разрешения локальных и интернет-имен (переадресация DNS)  <br/> |
|Распределенная  <br/> |Разрешение локальных и интернет-имен локальной службой  <br/> Виртуальная машина Azure для разрешения локальных имен и имен в интрасети (репликация и переадресация DNS)  <br/> |
   
 **Таблица 4. Варианты DNS-серверов для двух различных типов виртуальных сетей**
  
Для получения дополнительных сведений см [Разрешение имен для виртуальных машин и роль экземпляров](https://docs.microsoft.com/azure/virtual-network/virtual-networks-name-resolution-for-vms-and-role-instances).
  
### <a name="step-7-determine-the-load-balancing-configuration-internet-facing-or-internal"></a>Шаг 7. Определите конфигурацию балансировки нагрузки (для внутреннего или интернет-трафика).

В некоторых случаях входящий трафик требуется распределить по нескольким серверам, которым назначена одна и та же роль. В Azure IaaS имеются встроенные средства для этого в отношении внутреннего и интернет-трафика.
  
Подсистема балансировки нагрузки Azure для интернет-трафика случайным образом распределяет нежелательный входящий трафик из Интернета среди участников набора балансировки нагрузки. 
  
**Рис. 4. Внешний балансировщик нагрузки в Azure**

![Рис. 4. Внешний балансировщик нагрузки в Azure](media/eb5945e5-0c2b-40f1-b9ed-54bb2b0f9e59.png)
  
На рисунке 4 показано балансировки нагрузки в Azure, которая распределяет входящий трафик на входящий правила преобразования сетевых адресов или конечную точку в набор виртуальных машин в набор подсистемы балансировки нагрузки.
  
Подсистема балансировки нагрузки Azure для внутреннего трафика случайным образом распределяет незапрошенный входящий трафик от других виртуальных машин или компьютеров в интрасети среди участников набора балансировки нагрузки.  
  
**Рис. 5. Внутренний балансировщик нагрузки в Azure**

![Рис. 5. Внутренний балансировщик нагрузки в Azure](media/d1451b73-6465-449d-b3e6-22160ce51f35.png)
  
На рисунке 5 показано балансировки нагрузки внутренних в Azure, которая распределяет входящий трафик на входящий правила преобразования сетевых адресов или конечную точку в набор виртуальных машин в набор подсистемы балансировки нагрузки.
  
Для получения дополнительных сведений см [Балансировки нагрузки для Azure](https://docs.microsoft.com/azure/load-balancer/load-balancer-overview).
  
### <a name="step-8-determine-the-use-of-virtual-appliances-and-user-defined-routes"></a>Шаг 8. Определите порядок использования виртуальных модулей и пользовательских маршрутов в Azure.

Если требуется перенаправить трафик на виртуальные модули в виртуальной сети, возможно, в подсеть потребуется добавить один или несколько пользовательских маршрутов.
  
**Рис. 6. Виртуальные устройства и пользовательские маршруты в Azure**

![Рис. 6. Виртуальные устройства и пользовательские маршруты в Azure](media/f181d0f4-ebf9-439e-9c98-dec17428c32b.png)
  
На рисунке 6 представлена распределенная виртуальная сеть и пользовательский маршрут, назначенный подсети с размещенными виртуальными машинами, которая указывает на виртуальный модуль.
  
Для получения дополнительных сведений см [маршруты определенных пользователей и IP-адрес переадресации](https://docs.microsoft.com/azure/virtual-network/virtual-networks-udr-overview).
  
### <a name="step-9-determine-how-computers-from-the-internet-will-connect-to-virtual-machines"></a>Шаг 9. Определите, как компьютеры из Интернета будут автоматически подключаться к виртуальным машинам.

Существуют различные способы предоставить виртуальным машинам в виртуальной сети доступ к Интернету, который включает доступ из сети организации через прокси-сервер или другое пограничное устройство.
  
В таблице 5 перечислены способы фильтрации или проверки незапрошенного входящего трафика.
  
|**Метод**|**Модель развертывания**|
|:-----|:-----|
|1. Конечные точки и списки управления доступом, настроенные в облачных службах  <br/> |Классическая  <br/> |
|2. Группы безопасности сети  <br/> |Классическая с использованием диспетчера ресурсов  <br/> |
|3. Подсистема балансировки нагрузки для интернет-трафика с правилами NAT для входящего трафика  <br/> |Руководитель ресурсов  <br/> |
|4. сетевых устройств безопасности в Azure Marketplace (не отображается)  <br/> |Классическая с использованием диспетчера ресурсов  <br/> |
   
 **Таблица 5. Способы подключения к виртуальным машинам и соответствующие модели развертывания Azure**
  
**Рис. 7. Подключение к виртуальным машинам Azure через Интернет**

![Рис. 7. Подключение к виртуальным машинам Azure через Интернет](media/c5e3531b-170a-4482-a6ff-fb8fbbe81b35.png)
  
На рисунке 7 показано подключение компьютера с доступом в Интернет к виртуальной машине в облачной службе через конечную точку, к виртуальной машине в подсети с помощью группы безопасности сети, а также к виртуальной машине в подсети с помощью внешней подсистемы балансировки нагрузки и правил NAT для входящего трафика.
  
Дополнительная безопасность обеспечивается за счет следующего:
  
- Подключение удаленного рабочего стола и подключение SSH, которые зашифрованы и используют проверку подлинности.
    
- Сеансы удаленной среды PowerShell, которые зашифрованы и используют проверку подлинности.
    
- Режим транспорта IPsec, который можно использовать для сквозного шифрования.
    
- Защита Azure от атак DDoS, позволяющая предотвратить внешние и внутренние атаки.
    
Для получения дополнительных сведений см [Microsoft Cloud для архитекторов корпоративной](https://aka.ms/cloudarchsecurity) [Безопасности сети Azure](https://azure.microsoft.com/blog/azure-network-security/).
  
### <a name="step-10-for-multiple-vnets-determine-the-vnet-to-vnet-connection-topology"></a>Шаг 10. Если имеется несколько виртуальных сетей, определите топологию подключения "виртуальная сеть–виртуальная сеть".

Виртуальные сети можно подключать между собой, используя для этого такие же топологии, что и для подключения сайтов организации.
  
Гирляндная конфигурация подразумевает последовательное подключение виртуальных сетей.
  
**Рис. 8. Конфигурация с последовательным подключением виртуальных сетей**

![Рис. 8. Последовательная конфигурация для виртуальных сетей Azure](media/264d5dd4-06c5-483f-9428-a18cc1f68ac1.png)
  
На рисунке 8 показана пять VNets подключен последовательно с помощью конфигурации последовательно.
  
Звездообразная конфигурация подразумевает подключение нескольких виртуальных сетей к ряду центральных виртуальных сетей, соединенных между собой.
  
**Рис. 9. Звездообразная конфигурация виртуальных сетей**

![Рис. 9. Звездообразная конфигурация и конфигурация с концентратором для виртуальных сетей Azure](media/dd442a38-5b76-4ac5-b743-8fc7711a91ba.png)
  
На рисунке 9 показаны шесть виртуальных сетей, где две из которых являются центральными сетями, соединенными между собой, а остальные виртуальные сети подключены к этим центральным сетям.
  
В конфигурации полной сетки все виртуальные сети соединены непосредственно друг с другом.
  
**Рис. 10. Конфигурация полной сетки для виртуальных сетей**

![Рис. 10. Сеточная конфигурация для виртуальных сетей Azure](media/9dda0738-10db-4a63-95b3-79851a399b71.png)
  
На рисунке 10 показаны четыре виртуальные сети, которые подключены непосредственно друг к другу с помощью шести подключений типа "виртуальная сеть–виртуальная сеть".
  
## <a name="planning-steps-for-a-cross-premises-vnet"></a>Этапы планирования для распределенной виртуальной сети
<a name="cross_prem"> </a>

Ниже перечислены шаги, которыми следует руководствоваться при планировании распределенной виртуальной сети.
  
> [!TIP]
> Сведения о том, как создать имитацию гибридной среды разработки и тестирования в Azure, см. в статье [Simulated cross-premises virtual network in Azure](simulated-cross-premises-virtual-network-in-azure.md). 
  
### <a name="step-1-determine-the-cross-premises-connection-to-the-vnet-s2s-vpn-or-expressroute"></a>Шаг 1. Определите тип подключения к распределенной виртуальной сети (подключение VPN типа "сеть–сеть" или ExpressRoute).

В таблице 6 перечислены различные типы подключений.
  
|**Тип подключения**|**Цель**|
|:-----|:-----|
|VPN типа "сеть–сеть"  <br/> |Подключение сайтов 1-10 (в том числе других VNets) к одной VNet.  <br/> |
|ExpressRoute  <br/> |Закрытое, защищенное подключение к Azure через поставщика услуг обмена интернет-трафиком (IXP) или поставщика сетевых услуг (NSP).  <br/> |
|Подключение VPN типа "точка–сеть"  <br/> |Подключение отдельного компьютера к виртуальной сети.  <br/> |
|Пиринговая виртуальная сеть или VNet-to-VNet (V2V) VPN   <br/> |Подключение одной виртуальной сети к другой.  <br/> |
   
 **Таблица 6. Типы подключений для распределенных виртуальных сетей**
  
Дополнительные сведения о максимальное число подключений содержатся в разделе [Ограничения для сети](https://docs.microsoft.com/azure/azure-subscription-service-limits#networking-limits).
  
Дополнительные сведения о VPN-устройства можно [VPN-устройства для подключения к веб сайта виртуальной сети](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpn-devices).
  
Дополнительные сведения о VNet авторами можно [VNet авторами](https://docs.microsoft.com/azure/virtual-network/virtual-network-peering-overview).
  
**Рис. 11. Четыре способа подключения к распределенной виртуальной сети**

![Рис. 11. Три способа подключения к распределенной виртуальной сети Azure](media/d5d4a625-cfbd-4a77-9159-eaca69d07e93.png)
  
На рисунке 11 показаны VNet с четырьмя типами подключений: подключение P2S с компьютера, подключение к виртуальной частной сети S2S из локальной сети, подключения к ExpressRoute из локальной сети и VNet-VNet подключения из другой VNet. 
  
Подключиться к виртуальным машинам в виртуальной сети можно следующими способами:
  
- Администрирование виртуальных машин в виртуальной сети из локальной сети или через Интернет
    
- Доступ к рабочей ИТ-нагрузке из локальной сети
    
- Расширение сети с помощью дополнительных виртуальных сетей
    
Безопасность подключений обеспечивается за счет следующего:
  
- Для подключения типа "точка–сеть" используется протокол Secure Socket Tunneling Protocol (SSTP)  
    
- Для подключений VPN типа "сеть–сеть" и "виртуальная сеть–виртуальная сеть" используется туннельный режим IPsec с шифрованием AES256
    
- ExpressRoute представляет собой частное подключение WAN
    
Для получения дополнительных сведений см [Microsoft Cloud для архитекторов корпоративной](https://aka.ms/cloudarchsecurity) [Безопасности сети Azure](https://azure.microsoft.com/blog/azure-network-security/).
  
### <a name="step-2-determine-the-on-premises-vpn-device-or-router"></a>Шаг 2. Определите локальное VPN-устройство или маршрутизатор.

Локальное VPN-устройство или маршрутизатор выступает в качестве:
  
- оконечного узла IPsec подключения VPN типа "сеть–сеть" от шлюза Azure;
    
- узла BPG и оконечной точки для частного пирингового подключения ExpressRoute.
    
**Рис. 12. Локальный маршрутизатор или устройство VPN**

![Рис. 12. Локальный маршрутизатор или устройство VPN](media/bd221468-a660-4730-aa55-0426986480b9.png)
  
На рисунке 12 показана распределенная виртуальная сеть, подключенная к локальному VPN-устройству или маршрутизатору.
  
Для получения дополнительных сведений см [шлюза о VPN](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-about-vpngateways).
  
### <a name="step-3-add-routes-to-your-intranet-to-make-the-address-space-of-the-vnet-reachable"></a>Шаг 3: Добавление маршрутов для интрасети, чтобы сделать доступным адресное пространство VNet.

Маршрут к виртуальной сети из локальной сети включает следующее:
  
1. Маршрут для адресного пространства виртуальной сети до вашего VPN-устройства.
    
2. Маршрут для адресного пространства виртуальной сети на VPN-устройстве до подключения VPN типа "сеть–сеть"или подключения ExpressRoute.
    
**Рис. 13. Локальные маршруты, необходимые для того, чтобы сделать виртуальную сеть доступной**

![Рис. 13. Локальные маршруты, необходимые для обеспечения доступности виртуальной сети Azure](media/7a1e20c1-fbc4-4cb9-9961-735da4e23307.png)
  
На рисунке 13 показаны сведения о маршрутах, необходимые локальным маршрутизаторам и VPN-устройству или маршрутизатору, представляющему адресное пространство виртуальной сети.
  
### <a name="step-4-for-expressroute-plan-for-the-new-connection-with-your-provider"></a>Шаг 4. Если используется подключение ExpressRoute, спланируйте новое подключение вместе со своим поставщиком.

Создать частное пиринговое соединение ExpressRoute между локальной сетью и облаком Майкрософт можно тремя различными способами:
  
- Совместное размещение в облачном обменнике
    
- Подключение типа "точка-точка" через Ethernet
    
- Подключение типа "любой-к-любому" (IP-VPN)
    
**Рис. 14. Использование ExpressRoute для подключения к распределенной виртуальной сети**

![Рис. 14. Подключение к распределенной виртуальной сети Azure с помощью ExpressRoute](media/7030bd39-69a6-4283-8567-3434e1ab6ba6.png)
  
На рисунке 14 показана распределенная виртуальная сеть и подключение ExpressRoute от локального маршрутизатора к Microsoft Azure.
  
Дополнительные сведения см. в статье [ExpressRoute для подключения к Microsoft Cloud](expressroute-for-microsoft-cloud-connectivity.md).
  
### <a name="step-5-determine-the-local-network-address-space-for-the-azure-gateway"></a>Шаг 5. Определите адресное пространство локальной сети для шлюза Azure.

Для маршрутизации трафика в локальную сеть или другие виртуальные сети Azure переадресовывает его через шлюз Azure, соответствующий адресному пространству локальной сети, которое назначено шлюзу.
  
**Рис. 15. Адресное пространство локальной сети для распределенной виртуальной сети**

![Рис. 15. Адресное пространство локальной сети для распределенной виртуальной сети Azure](media/e3af2652-8b8e-4551-9a0b-b550e6e7e3c0.png)
  
На рисунке 15 показаны распределенная виртуальная сеть и адресное пространство локальной сети на шлюзе Azure, которое представляет собой достижимое адресное пространство локальной сети.  
  
Адресное пространство локальной сети можно определить следующим образом:
  
- Способ 1. Создание списка префиксов адресного пространства, которые требуются или используются (этот список необходимо обновлять при добавлении новых подсетей).
    
- Способ 2. Использование всего адресного пространства локальной сети (этот список необходимо обновлять только при добавлении нового адресного пространства).
    
Поскольку шлюз Azure не поддерживает суммированные маршруты, необходимо определить адресное пространство локальной сети для способа 2, исключив из него адресное пространство виртуальной сети.
  
**Рис. 16. Пробел в адресном пространстве, созданный адресным пространством виртуальной сети**

![Рис. 16. Пробел в адресном пространстве, созданный адресным пространством виртуальной сети](media/e79c4840-f9e3-4741-9b72-59db6043aefa.png)
  
На рисунке 16 представлено адресное пространство с корневым пространством и адресным пространством виртуальной сети.
  
Ниже приведен пример определения префиксы для локальной сети адресного пространства вокруг адресное пространство «дыра», созданный с VNet:
  
- Организация использует фрагменты частного адресного пространства (10.0.0.0/8, 172.16.0.0/12 и 192.168.0.0/16) в своей локальной сети. Был выбран способ 2, а в качестве адресного пространства виртуальной сети — пространство 10.100.100.0/24.
    
В таблице 7 представлены действия и полученные в их результате префиксы, определяющие адресное пространство локальной сети для этого примера.
  
|**Шаг**|**Результаты**|
|:-----|:-----|
|1. Создание списка префиксов, которые отсутствуют в корневом пространстве, для адресного пространства виртуальной сети.  <br/> |172.16.0.0/12 и 192.168.0.0/16  <br/> |
|2. список префиксов без перекрытия для переменной октетов до, но не включая последний использованный октета в VNet адресного пространства.  <br/> |10.0.0.0/16, 10.1.0.0/16... 10.99.0.0/16, 10.101.0.0/16... 10.254.0.0/16 10.255.0.0/16 (255 префиксов, пропуск 10.100.0.0/16)  <br/> |
|3. список префиксы без перекрытия в последний использованный октета VNet адресного пространства.  <br/> |10.100.0.0/24, 10.100.1.0/24... 10.100.99.0/24, 10.100.101.0/24... 10.100.254.0/24 10.100.0.255.0/24 (255 префиксов, пропуск 10.100.100.0/24)  <br/> |
   
 **Таблица 7. Пример сетевого пространства локальных адресов**
  
### <a name="step-6-configure-on-premises-dns-servers-for-dns-replication-with-dns-servers-hosted-in-azure"></a>Шаг 6. Настройте локальные DNS-серверы на репликацию DNS с помощью DNS-серверов, размещенных в Azure.

Чтобы локальные компьютеры могли разрешать имена серверов, размещенных в Azure, а последние могли разрешать имена локальных компьютеров, настройте следующее:
  
- DNS-серверы в вашей виртуальной сети на переадресацию на локальные DNS-серверы;
    
- репликацию DNS для соответствующих зон между DNS-серверами локальной и виртуальной сетей.
    
**Рис. 17. Репликация и переадресация DNS для DNS-сервера в распределенной виртуальной сети**

![Рис.17. Репликация и переадресация DNS для DNS-сервера в распределенной виртуальной сети Azure](media/ab55e5ce-ccb0-49d4-a301-657a727f97b2.png)
  
На рисунке 17 показана распределенная виртуальная сеть с DNS-серверами в локальной сети и подсети в виртуальной сети. Между этими двумя DNS-серверами настроены репликация и переадресация DNS.
  
### <a name="step-7-determine-the-use-of-forced-tunneling"></a>Шаг 7. Определите использование принудительного туннелирования.

Указывает маршрут системы по умолчанию для Azure подсетей в Интернет. Чтобы убедиться, что все из виртуальных машин проходит через подключение между организациями, создайте таблицу маршрутизации с маршрутом по умолчанию, использующий Azure шлюза в качестве его адрес следующего прыжка. В таблице Маршрут затем свяжите с подсетью. Это называется Принудительное туннелирование. Дополнительные сведения можно [настроить Принудительное туннелирование](https://docs.microsoft.com/azure/vpn-gateway/vpn-gateway-forced-tunneling-rm).
  
**Рис. 18. Пользовательские маршруты и принудительное туннелирование для распределенной виртуальной сети**

![Рис. 18. Пользовательские маршруты и принудительное туннелирование для распределенной виртуальной сети Azure](media/1e545ec6-c2d9-48d2-bb5e-e0a581fee004.png)
  
На рисунке 18 показан VNet между организациями с помощью пользовательских маршрут к подсети с указанием Azure шлюза.
  
## <a name="sharepoint-server-2016-farm-in-azure"></a>Ферма SharePoint Server 2016 в Azure
<a name="cross_prem"> </a>

Пример интрасети рабочей нагрузки ИТ, размещенные в Azure IaaS — в ферме SharePoint Server 2016 высокой доступностью, многоуровневые.
  
**Рисунок 19. Высокодоступная ферма SharePoint Server 2016 в интрасети в Azure IaaS**

![Высокодоступная ферма SharePoint Server 2016 в Azure IaaS](media/3a922e21-df91-455f-ba90-78abdd48d98d.png)
  
На рисунке 19 показан девяти серверов SharePoint Server 2016 фермы, развернутой в VNet между организациями, поддерживающей подсистемы балансировки нагрузки внутренних уровни переднего плана и данных. Дополнительные сведения, включая пошаговые проектирования и инструкции по развертыванию можно [2016 сервера SharePoint в Microsoft Azure](https://docs.microsoft.com/SharePoint/administration/sharepoint-server-2016-in-microsoft-azure).
  
> [!TIP]
> Создание фермы SharePoint Server 2016 одним сервером в VNet имитации между организациями, видеть [интрасети 2016 сервера SharePoint в среде Azure разработку и тестирование](https://docs.microsoft.com/SharePoint/administration/intranet-sharepoint-server-2016-in-azure-dev-test-environment). 
  
Дополнительные примеры рабочих нагрузок ИТ, развернутых на виртуальных машинах в виртуальной среде Azure распределенной сети [гибридных сценариев облака для Azure IaaS](https://docs.microsoft.com/office365/enterprise/hybrid-cloud-scenarios-for-azure-iaas)см.
  
## <a name="see-also"></a>См. также

[Организация сети в Microsoft Cloud для корпоративных архитекторов](microsoft-cloud-networking-for-enterprise-architects.md)
  
[Материалы по архитектуре Microsoft Cloud](microsoft-cloud-it-architecture-resources.md)


